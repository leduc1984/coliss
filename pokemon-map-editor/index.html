<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokemon ORAX Map Editor - Professional Game Development Tool</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="professional-editor.css">
    <link rel="stylesheet" href="extended-editor.css">
    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
    <script src="https://cdn.babylonjs.com/materialsLibrary/babylonjs.materials.min.js"></script>
    <script src="https://cdn.babylonjs.com/gui/babylon.gui.min.js"></script>
</head>
<body>
    <header id="top-bar">
        <div class="title-area">
            <h1 class="editor-title">Map Editor</h1>
        </div>
        <div class="main-controls">
            <input type="file" id="fileInput" accept=".glb" style="display: none;">
            <button type="button" id="loadMainMapBtn">Charger Carte (.glb)</button>
            <input type="file" id="collisionFileInput" accept=".glb" style="display: none;">
            <button type="button" id="loadCollisionBtn">Charger Collisions (.glb)</button>
            <button type="button" id="exportBtn">Exporter Donn√©es (.json)</button>
            <input type="file" id="importFile" accept=".json" style="display: none;">
            <button type="button" id="importBtn">Importer Donn√©es (.json)</button>
            <button type="button" id="exportUILayoutBtn">Exporter UI (.json)</button>
            <input type="file" id="importUILayoutFile" accept=".json" style="display: none;">
            <button type="button" id="importUILayoutBtn">Importer UI (.json)</button>
            <button type="button" id="testModeBtn">Mode Test</button>
            <div class="separator"></div>
            <button type="button" id="toggleGridBtn">Grille ON/OFF</button>
            <button type="button" id="toggleCollisionBtn" class="active">Collisions ON</button>
            <div class="separator"></div>
            <button type="button" id="selectToolBtn" class="tool-btn active">S√©lectionner</button>
            <button type="button" id="multiSelectBtn" class="tool-btn">S√©lection Multiple</button>
            <button type="button" id="pokemonZoneBtn" class="tool-btn">Zone Pok√©mon</button>
            <button type="button" id="npcPlaceBtn" class="tool-btn">Placer PNJ</button>
            <button type="button" id="warpPointBtn" class="tool-btn">Point de T√©l√©portation</button>
            <div class="separator"></div>
            <button type="button" id="prefabBtn" class="tool-btn">Pr√©fabriqu√©s</button>
            <button type="button" id="eventEditorBtn" class="tool-btn">√âv√©nements</button>
            <button type="button" id="measureToolBtn" class="tool-btn">Mesurer</button>
        </div>
        <div class="window-controls">
            <button type="button" id="minimizeEditorBtn" class="window-control-btn" title="Minimize">_</button>
            <button type="button" id="fullscreenEditorBtn" class="window-control-btn" title="Fullscreen">‚õ∂</button>
            <button type="button" id="closeEditorBtn" class="window-control-btn" title="Close">X</button>
        </div>
    </header>

    <main id="editor-container">
        <aside id="left-panel" class="panel">
            <div id="selectToolPanel" class="tool-panel">
                <h3>Object Properties</h3>
                <div id="propertiesPanelContent">Select an object to view its properties.</div>
            </div>
            
            <div id="mapObjectsPanel" class="tool-panel">
                <h3>Map Objects Library</h3>
                <div class="object-categories">
                    <div class="object-category">
                        <h4>üè† Buildings</h4>
                        <div class="object-grid" id="buildingsGrid">
                            <div class="object-item" data-object="house.glb">
                                <div class="object-thumbnail">üè†</div>
                                <div class="object-name">House</div>
                            </div>
                            <div class="object-item" data-object="pokecenter.glb">
                                <div class="object-thumbnail">üè•</div>
                                <div class="object-name">Pokemon Center</div>
                            </div>
                            <div class="object-item" data-object="mart.glb">
                                <div class="object-thumbnail">üè™</div>
                                <div class="object-name">Poke Mart</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="object-category">
                        <h4>üå≥ Nature</h4>
                        <div class="object-grid" id="natureGrid">
                            <div class="object-item" data-object="tree.glb">
                                <div class="object-thumbnail">üå≥</div>
                                <div class="object-name">Tree</div>
                            </div>
                            <div class="object-item" data-object="rock.glb">
                                <div class="object-thumbnail">üóø</div>
                                <div class="object-name">Rock</div>
                            </div>
                            <div class="object-item" data-object="flower.glb">
                                <div class="object-thumbnail">üå∏</div>
                                <div class="object-name">Flower</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="object-category">
                        <h4>üéÆ Interactive</h4>
                        <div class="object-grid" id="interactiveGrid">
                            <div class="object-item" data-object="sign.glb">
                                <div class="object-thumbnail">ü™ß</div>
                                <div class="object-name">Sign</div>
                            </div>
                            <div class="object-item" data-object="door.glb">
                                <div class="object-thumbnail">üö™</div>
                                <div class="object-name">Door</div>
                            </div>
                            <div class="object-item" data-object="chest.glb">
                                <div class="object-thumbnail">üì¶</div>
                                <div class="object-name">Treasure</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="pokemonZonePanel" class="tool-panel" style="display: none;">
                <h3>Pokemon Zone Editor</h3>
                <label for="zoneType">Zone Type:</label>
                <select id="zoneType">
                    <option value="grass">Grass</option>
                    <option value="water">Water</option>
                </select>
                <button type="button" id="paintZoneBtn">Paint Zone</button>
                <hr>
                <h4>Encounters for selected zone</h4>
                <div id="encounterEditor">
                    <select id="pokemonSelect"></select>
                    <button type="button" id="openSpriteSelector">...</button>
                    <input type="number" id="minLevel" value="5" title="Min Level">
                    <input type="number" id="maxLevel" value="10" title="Max Level">
                    <input type="number" id="encounterRate" value="10" title="Rate (%)">
                    <button type="button" id="addEncounterBtn">+</button>
                    <div id="encounterList"></div>
                </div>
            </div>
            
            <div id="prefabPanel" class="tool-panel" style="display: none;">
                <h3>Biblioth√®que de Pr√©fabriqu√©s</h3>
                <div class="prefab-controls">
                    <button type="button" id="createPrefabBtn">Cr√©er Pr√©fabriqu√©</button>
                    <button type="button" id="importPrefabBtn">Importer</button>
                    <button type="button" id="exportPrefabBtn">Exporter</button>
                </div>
                <div class="prefab-search">
                    <label for="prefabSearch" class="sr-only">Rechercher pr√©fabriqu√©s</label>
                    <input type="text" id="prefabSearch" placeholder="Rechercher pr√©fabriqu√©s...">
                    <label for="prefabCategory" class="sr-only">Cat√©gorie de pr√©fabriqu√©</label>
                    <select id="prefabCategory">
                        <option value="">Toutes cat√©gories</option>
                        <option value="buildings">B√¢timents</option>
                        <option value="nature">Nature</option>
                        <option value="pokemon">Pok√©mon</option>
                        <option value="custom">Personnalis√©</option>
                    </select>
                </div>
                <div id="prefabGrid" class="prefab-grid">
                    </div>
            </div>
            
            <div id="multiSelectPanel" class="tool-panel" style="display: none;">
                <h3>S√©lection Multiple</h3>
                <div class="selection-info">
                    <p id="selectionCount">0 objets s√©lectionn√©s</p>
                </div>
                <div class="selection-controls">
                    <button type="button" id="groupSelectedBtn">Grouper (Ctrl+G)</button>
                    <button type="button" id="ungroupSelectedBtn">D√©grouper (Ctrl+U)</button>
                    <button type="button" id="copySelectedBtn">Copier (Ctrl+C)</button>
                    <button type="button" id="pasteBtn">Coller (Ctrl+V)</button>
                    <button type="button" id="duplicateSelectedBtn">Dupliquer (Ctrl+D)</button>
                    <button type="button" id="deleteSelectedBtn">Supprimer (Del)</button>
                </div>
                <div class="selection-transform">
                    <h4>Transformation Groupe</h4>
                    <label for="groupPosX">Position X:</label>
                    <input type="number" id="groupPosX" step="0.1">
                    <label for="groupPosY">Position Y:</label>
                    <input type="number" id="groupPosY" step="0.1">
                    <label for="groupPosZ">Position Z:</label>
                    <input type="number" id="groupPosZ" step="0.1">
                    <label for="groupRotY">Rotation Y:</label>
                    <input type="number" id="groupRotY" step="1" min="0" max="360">
                    <label for="groupScale">√âchelle:</label>
                    <input type="number" id="groupScale" step="0.1" min="0.1" value="1">
                </div>
            </div>
            
            <div id="measurePanel" class="tool-panel" style="display: none;">
                <h3>Outil de Mesure</h3>
                <div class="measure-controls">
                    <button type="button" id="startMeasureBtn">Commencer Mesure</button>
                    <button type="button" id="clearMeasuresBtn">Effacer Mesures</button>
                </div>
                <div id="measureResults">
                    <h4>R√©sultats:</h4>
                    <div id="measureList">
                        </div>
                </div>
                <div class="measure-settings">
                    <label for="measureUnit">Unit√©s:</label>
                    <select id="measureUnit">
                        <option value="meters">M√®tres</option>
                        <option value="tiles">Tuiles</option>
                        <option value="units">Unit√©s</option>
                    </select>
                </div>
            </div>
            
            <div id="collisionPanel" class="tool-panel" style="display: none;">
                <h3>Propri√©t√©s de Collision</h3>
                <div class="collision-controls">
                    <label for="collisionTypeSelect">Type de Collision:</label>
                    <select id="collisionTypeSelect">
                        <option value="blocked">Bloqu√©</option>
                        <option value="trigger">D√©clencheur</option>
                        <option value="interactable">Interactif</option>
                    </select>
                    <button type="button" id="applyCollisionTypeBtn">Appliquer</button>
                    <hr>
                    <button type="button" id="addCollisionBtn">Ajouter comme Collision</button>
                    <button type="button" id="removeCollisionBtn">Retirer Collision</button>
                    <button type="button" id="duplicateCollisionBtn">Dupliquer Collision</button>
                    
                    <div id="collisionPropertiesPanel" style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #444;">
                        <h4>Propri√©t√©s Avanc√©es</h4>
                        <label for="collisionTriggerType">Type de D√©clencheur:</label>
                        <select id="collisionTriggerType">
                            <option value="teleport">T√©l√©portation</option>
                            <option value="event">√âv√©nement</option>
                            <option value="encounter">Rencontre Pok√©mon</option>
                        </select>
                        
                        <label for="collisionDestinationMap">Carte de Destination:</label>
                        <input type="text" id="collisionDestinationMap" placeholder="Nom de la carte" style="width: 100%; margin: 5px 0; padding: 5px;">
                        
                        <label>Position de Destination:</label>
                        <div style="display: flex; gap: 10px;">
                            <label for="collisionDestinationX" class="sr-only">Destination X</label>
                            <input type="number" id="collisionDestinationX" placeholder="X" style="flex: 1; padding: 5px;" step="0.1">
                            <label for="collisionDestinationZ" class="sr-only">Destination Z</label>
                            <input type="number" id="collisionDestinationZ" placeholder="Z" style="flex: 1; padding: 5px;" step="0.1">
                        </div>
                        
                        <button type="button" id="saveCollisionPropertiesBtn" style="margin-top: 10px; width: 100%;">Sauvegarder Propri√©t√©s</button>
                    </div>
                    
                    <div id="collisionCreationPanel" style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #444;">
                        <h4>Outils de Cr√©ation</h4>
                        <button type="button" id="createCollisionVolumeBtn" style="width: 100%; margin-bottom: 5px;">Cr√©er Volume de Collision</button>
                        <button type="button" id="createTriggerVolumeBtn" style="width: 100%; margin-bottom: 5px;">Cr√©er Volume de D√©clenchement</button>
                        <button type="button" id="paintCollisionBtn" style="width: 100%;">Peindre les Collisions</button>
                        
                        <div style="margin-top: 10px;">
                            <label for="creationCollisionType">Type de Collision √† Cr√©er:</label>
                            <select id="creationCollisionType" style="width: 100%; margin: 5px 0; padding: 5px;">
                                <option value="blocked">Bloqu√©</option>
                                <option value="trigger">D√©clencheur</option>
                                <option value="interactable">Interactif</option>
                            </select>
                            
                            <label for="newVolumeTriggerType">Type de D√©clencheur √† Cr√©er:</label>
                            <select id="newVolumeTriggerType" style="width: 100%; margin: 5px 0; padding: 5px;">
                                <option value="teleport">T√©l√©portation</option>
                                <option value="event">√âv√©nement</option>
                                <option value="encounter">Rencontre Pok√©mon</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="batchCompressionPanel" style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #444;">
                        <h4>Outils de Compression</h4>
                        <label for="compressionQuality">Qualit√© de Compression:</label>
                        <select id="compressionQuality" style="width: 100%; margin: 5px 0; padding: 5px;">
                            <option value="low">Basse (Taille +, Qualit√© -)</option>
                            <option value="medium" selected>Moyenne (√âquilibr√©)</option>
                            <option value="high">Haute (Taille -, Qualit√© +)</option>
                        </select>
                        
                        <button type="button" id="batchCompressBtn" style="width: 100%; margin-top: 10px; background: #4caf50; color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer;">
                            üîß Compresser les Actifs
                        </button>
                        
                        <div style="margin-top: 10px; font-size: 12px; color: #aaa;">
                            <p>üí° La compression Draco r√©duit la taille des fichiers GLB jusqu'√† 80%</p>
                            <p>üöÄ Am√©liore les temps de chargement et la performance</p>
                        </div>
                    </div>
                </div>
            </div>
        </aside>
        <div class="splitter" id="left-splitter"></div>
        <canvas id="renderCanvas"></canvas>
        <div class="splitter" id="right-splitter"></div>
        <aside id="right-panel" class="panel">
            <h3>Inspecteur de Sc√®ne</h3>
            <label for="meshSearch" class="sr-only">Rechercher un objet</label>
            <input type="text" id="meshSearch" placeholder="Rechercher...">
            <div id="meshPanel"></div>
        </aside>
    </main>

    <div id="spriteSelectorModal" class="modal-backdrop">
        <div class="modal-content">
            <header class="modal-header">
                <h3>Choisir un Pok√©mon</h3>
                <button type="button" id="closeSpriteSelector" aria-label="Fermer">&times;</button>
            </header>
            <div id="spriteGridContainer"></div>
        </div>
    </div>

    <script src="pokemon-data.js" defer></script>
    <script src="pokemon-sprites.js" defer></script>
    <script src="utils.js" defer></script>
    <script src="GridSystem.js" defer></script>
    <script src="SelectionManager.js" defer></script>
    <script src="PrefabManager.js" defer></script>
    <script src="EventEditor.js" defer></script>
    <script src="PokemonToolsExtended.js" defer></script>
    <script src="AdvancedEditorIntegration.js" defer></script>
    <script src="APIService.js" defer></script>
    <script src="UIComponentSystem.js" defer></script>
    <script src="editor.js" defer></script>
</body>
</html>